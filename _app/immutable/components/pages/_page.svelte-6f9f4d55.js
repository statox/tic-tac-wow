import{S as J,i as L,s as q,k as w,l as M,m as E,h as _,n as W,I as $,b as S,J as j,B as z,K as Y,q as A,a as I,r as N,c as C,G as v,u as Z,L as ke,f as y,g as x,d as ee,t as k,e as le,w as D,x as H,y as G,z as V,M as Se}from"../../chunks/index-3160ce5b.js";const ne=l=>{const e=l===1?1:-1,s=[1,1,2,2,3,3].map(t=>({value:t*e,selected:!1}));return{player:l,pieces:s}},se=()=>{const l=[];for(let s=0;s<3;s++){l.push([]);for(let t=0;t<3;t++)l[l.length-1].push([])}return{state:{player:1,action:"select1"},grid:l,player1:ne(1),player2:ne(2)}},T=(l,e,s)=>{if(e<0||s<0||e>2||s>2)throw new Error(`Invalid coordinates ${e},${s}`);if(!l[s][e].length)return null;const t=l[s][e][l[s][e].length-1];return t.value>0?1:t.value<0?2:null},me=(l,e,s)=>{if(e<0||s<0||e>2||s>2)throw new Error(`Invalid coordinates ${e},${s}`);if(!l[s][e].length)return 0;const t=l[s][e][l[s][e].length-1];return Math.abs(t.value)},B=(l,e,s)=>{const t=T(l,e.x,e.y),o=T(l,s.x,s.y);return t!==null&&t===o},ve=l=>{const{grid:e}=l;let s;for(let t=0;t<3;t++)B(e,{x:0,y:t},{x:1,y:t})&&B(e,{x:0,y:t},{x:2,y:t})&&(s=T(e,0,t));for(let t=0;t<3;t++)B(e,{x:t,y:0},{x:t,y:1})&&B(e,{x:t,y:0},{x:t,y:2})&&(s=T(e,t,0));B(e,{x:0,y:0},{x:1,y:1})&&B(e,{x:0,y:0},{x:2,y:2})&&(s=T(e,0,0)),B(e,{x:0,y:2},{x:1,y:1})&&B(e,{x:0,y:2},{x:2,y:0})&&(s=T(e,0,2)),s&&(l.state.player=s,l.state.action="winner")},$e=l=>JSON.parse(JSON.stringify(l)),we=(l,e,s)=>{e&&console.log(e);for(const t of[l.player1,l.player2]){if(s){console.log(`P${t.player}:`,t.pieces.map(o=>`${o.value}-${o.selected}`),t.selectedPiece);continue}console.log(`P${t.player}:`,t.pieces.map(o=>o.value))}},be=(l,e)=>{const s=[];for(let t=0;t<3;t++)for(let o=0;o<3;o++){const n=me(l.grid,o,t);(!n||n<Math.abs(e.value))&&s.push({x:o,y:t})}return s},Me=(l,e)=>ye(l,e).reduce((o,n)=>{const r=R(l,n),a=be(l,r);return a.length&&o.set(n,a),o},new Map),ye=(l,e)=>{const s=e.pieces.map((t,o)=>({indexInHand:o,from:"hand"}));for(let t=0;t<3;t++)for(let o=0;o<3;o++)T(l.grid,o,t)===e.player&&s.push({from:"board",position:{x:o,y:t}});return s},R=(l,e)=>{if(e.from==="board"){const t=l.grid[e.position.y][e.position.x];return t[t.length-1]}return(l.state.player===1?l.player1:l.player2).pieces[e.indexInHand]},F=(l,e,s)=>{if(l.state.player!==e.player||l.state.action!=="select1")return;if(e.pieces.findIndex(o=>o.value===s.value)===-1)throw new Error("Tried to select a piece which is not in hand");e.pieces.forEach(o=>o.selected=!1),s.selected=!0,e.selectedPiece={...s,from:"hand"},l.state.action="select2"},K=(l,e,s)=>{if(l.state.player!==e.player||l.state.action!=="select1")return;const{x:t,y:o}=s;if(t<0||o<0||t>2||o>2)throw new Error(`Invalid coordinates ${t},${o}`);l.grid[o][t].length!==0&&T(l.grid,t,o)===e.player&&(e.pieces.forEach(n=>n.selected=!1),l.grid[o][t][l.grid[o][t].length-1].selected=!0,e.selectedPiece={...l.grid[o][t][l.grid[o][t].length-1],from:"board",position:{x:t,y:o}},l.state.action="select2")},Q=(l,e)=>{var n;if(l.state.action!=="select2")return console.log("invalid state action"),-1;const s=l.state.player===1?l.player1:l.player2;if(!s.selectedPiece)return console.log("no selected piece"),-1;const{x:t,y:o}=e;if(me(l.grid,t,o)>=Math.abs(s.selectedPiece.value))return console.log("invalid board cell"),-1;if(l.grid[o][t].push({value:s.selectedPiece.value,selected:!1}),s.selectedPiece.from==="hand"){const r=s.pieces.findIndex(a=>a.selected);if(r===-1)throw we(l,"Invalid piece selection",!0),new Error("Tried to move piece not in hand");s.pieces.splice(r,1)}if(s.selectedPiece.from==="board")for(let r=0;r<3;r++)for(let a=0;a<3;a++)(n=l.grid[r][a][l.grid[r][a].length-1])!=null&&n.selected&&l.grid[r][a].pop();return s.selectedPiece=void 0,l.state.action="select1",l.state.player=l.state.player===1?2:1,ve(l),0},ge=(l,e)=>{const s=Me(l,e);if(s.size===0)throw Error("No move possible");const t=Array.from(s.keys()),o=Math.floor(Math.random()*t.length),n=t[o],r=R(l,n),a=Math.floor(Math.random()*s.get(n).length),i=s.get(n)[a];n.from==="hand"?F(l,e,r):K(l,e,n.position),Q(l,i)},oe=(l,e)=>{const s=ye(l,e);if(s.length===0)throw Error("No move possible");const t=s.sort(()=>Math.random()-.5);for(;t.length;){const o=t.pop();if(!o)continue;const n=R(l,o),a=[...be(l,n)].sort(()=>Math.random()-.5);for(;a.length;){const i=$e(l),c=i.state.player===1?i.player1:i.player2,f=R(i,o),p=a.pop();if(p&&(o.from==="hand"?F(i,c,f):K(i,c,o.position),Q(i,p),ve(i),i.state.action==="winner"&&i.state.player===e.player)){console.log("Make winning move");const b=R(l,o);o.from==="hand"?F(l,e,b):K(l,e,o.position),Q(l,p);return}}}console.log("default to random move"),ge(l,e)};function re(l,e,s){const t=l.slice();return t[4]=e[s],t}function ae(l){let e,s=l[4].value+"",t,o;return{c(){e=w("div"),t=A(s),o=I(),this.h()},l(n){e=M(n,"DIV",{class:!0});var r=E(e);t=N(r,s),o=C(r),r.forEach(_),this.h()},h(){W(e,"class","piece svelte-1bwmfvs"),$(e,"player1",l[4].value>0),$(e,"player2",l[4].value<0),$(e,"small-circle",Math.abs(l[4].value)===1),$(e,"medium-circle",Math.abs(l[4].value)===2),$(e,"large-circle",Math.abs(l[4].value)===3)},m(n,r){S(n,e,r),v(e,t),v(e,o)},p(n,r){r&1&&s!==(s=n[4].value+"")&&Z(t,s),r&1&&$(e,"player1",n[4].value>0),r&1&&$(e,"player2",n[4].value<0),r&1&&$(e,"small-circle",Math.abs(n[4].value)===1),r&1&&$(e,"medium-circle",Math.abs(n[4].value)===2),r&1&&$(e,"large-circle",Math.abs(n[4].value)===3)},d(n){n&&_(e)}}}function Ee(l){let e,s,t,o=[...l[0]].reverse(),n=[];for(let r=0;r<o.length;r+=1)n[r]=ae(re(l,o,r));return{c(){e=w("button");for(let r=0;r<n.length;r+=1)n[r].c();this.h()},l(r){e=M(r,"BUTTON",{class:!0});var a=E(e);for(let i=0;i<n.length;i+=1)n[i].l(a);a.forEach(_),this.h()},h(){W(e,"class","cell svelte-1bwmfvs"),$(e,"selected",l[1]),$(e,"disabled",l[2])},m(r,a){S(r,e,a);for(let i=0;i<n.length;i+=1)n[i].m(e,null);s||(t=j(e,"click",l[3]),s=!0)},p(r,[a]){if(a&1){o=[...r[0]].reverse();let i;for(i=0;i<o.length;i+=1){const c=re(r,o,i);n[i]?n[i].p(c,a):(n[i]=ae(c),n[i].c(),n[i].m(e,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=o.length}a&2&&$(e,"selected",r[1]),a&4&&$(e,"disabled",r[2])},i:z,o:z,d(r){r&&_(e),Y(n,r),s=!1,t()}}}function Ie(l,e,s){let{pieces:t}=e,{selected:o=!1}=e,{disabled:n}=e;function r(a){ke.call(this,l,a)}return l.$$set=a=>{"pieces"in a&&s(0,t=a.pieces),"selected"in a&&s(1,o=a.selected),"disabled"in a&&s(2,n=a.disabled)},[t,o,n,r]}class Pe extends J{constructor(e){super(),L(this,e,Ie,Ee,q,{pieces:0,selected:1,disabled:2})}}function ie(l,e,s){const t=l.slice();return t[3]=e[s],t[5]=s,t}function ce(l,e,s){const t=l.slice();return t[6]=e[s],t[8]=s,t}function fe(l){var o;let e,s;function t(){return l[2](l[8],l[5])}return e=new Pe({props:{pieces:l[6],disabled:!1,selected:(o=l[6][l[6].length-1])==null?void 0:o.selected}}),e.$on("click",t),{c(){D(e.$$.fragment)},l(n){H(e.$$.fragment,n)},m(n,r){G(e,n,r),s=!0},p(n,r){var i;l=n;const a={};r&1&&(a.pieces=l[6]),r&1&&(a.selected=(i=l[6][l[6].length-1])==null?void 0:i.selected),e.$set(a)},i(n){s||(y(e.$$.fragment,n),s=!0)},o(n){k(e.$$.fragment,n),s=!1},d(n){V(e,n)}}}function ue(l){let e,s,t=l[3],o=[];for(let r=0;r<t.length;r+=1)o[r]=fe(ce(l,t,r));const n=r=>k(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=le()},l(r){for(let a=0;a<o.length;a+=1)o[a].l(r);e=le()},m(r,a){for(let i=0;i<o.length;i+=1)o[i].m(r,a);S(r,e,a),s=!0},p(r,a){if(a&3){t=r[3];let i;for(i=0;i<t.length;i+=1){const c=ce(r,t,i);o[i]?(o[i].p(c,a),y(o[i],1)):(o[i]=fe(c),o[i].c(),y(o[i],1),o[i].m(e.parentNode,e))}for(x(),i=t.length;i<o.length;i+=1)n(i);ee()}},i(r){if(!s){for(let a=0;a<t.length;a+=1)y(o[a]);s=!0}},o(r){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)k(o[a]);s=!1},d(r){Y(o,r),r&&_(e)}}}function Ce(l){let e,s,t,o=l[0].grid,n=[];for(let a=0;a<o.length;a+=1)n[a]=ue(ie(l,o,a));const r=a=>k(n[a],1,1,()=>{n[a]=null});return{c(){e=w("div"),s=w("div");for(let a=0;a<n.length;a+=1)n[a].c();this.h()},l(a){e=M(a,"DIV",{class:!0});var i=E(e);s=M(i,"DIV",{class:!0});var c=E(s);for(let f=0;f<n.length;f+=1)n[f].l(c);c.forEach(_),i.forEach(_),this.h()},h(){W(s,"class","overlay svelte-1n6jeyv"),W(e,"class","board svelte-1n6jeyv")},m(a,i){S(a,e,i),v(e,s);for(let c=0;c<n.length;c+=1)n[c].m(s,null);t=!0},p(a,[i]){if(i&3){o=a[0].grid;let c;for(c=0;c<o.length;c+=1){const f=ie(a,o,c);n[c]?(n[c].p(f,i),y(n[c],1)):(n[c]=ue(f),n[c].c(),y(n[c],1),n[c].m(s,null))}for(x(),c=o.length;c<n.length;c+=1)r(c);ee()}},i(a){if(!t){for(let i=0;i<o.length;i+=1)y(n[i]);t=!0}},o(a){n=n.filter(Boolean);for(let i=0;i<n.length;i+=1)k(n[i]);t=!1},d(a){a&&_(e),Y(n,a)}}}function Ae(l,e,s){let{game:t}=e,{onSelectCell:o}=e;const n=(r,a)=>o(r,a);return l.$$set=r=>{"game"in r&&s(0,t=r.game),"onSelectCell"in r&&s(1,o=r.onSelectCell)},[t,o,n]}class Ne extends J{constructor(e){super(),L(this,e,Ae,Ce,q,{game:0,onSelectCell:1})}}function de(l,e,s){const t=l.slice();return t[7]=e[s],t}function pe(l){let e,s,t,o,n,r,a;return{c(){e=w("button"),s=A("Random"),t=I(),o=w("button"),n=A("Win or random")},l(i){e=M(i,"BUTTON",{});var c=E(e);s=N(c,"Random"),c.forEach(_),t=C(i),o=M(i,"BUTTON",{});var f=E(o);n=N(f,"Win or random"),f.forEach(_)},m(i,c){S(i,e,c),v(e,s),S(i,t,c),S(i,o,c),v(o,n),r||(a=[j(e,"click",l[4]),j(o,"click",l[5])],r=!0)},p:z,d(i){i&&_(e),i&&_(t),i&&_(o),r=!1,Se(a)}}}function he(l){let e,s;function t(){return l[6](l[7])}return e=new Pe({props:{disabled:l[1],pieces:[l[7]],selected:l[7].selected}}),e.$on("click",t),{c(){D(e.$$.fragment)},l(o){H(e.$$.fragment,o)},m(o,n){G(e,o,n),s=!0},p(o,n){l=o;const r={};n&2&&(r.disabled=l[1]),n&1&&(r.pieces=[l[7]]),n&1&&(r.selected=l[7].selected),e.$set(r)},i(o){s||(y(e.$$.fragment,o),s=!0)},o(o){k(e.$$.fragment,o),s=!1},d(o){V(e,o)}}}function Be(l){let e,s,t=l[0].player+"",o,n,r,a,i,c=!l[1]&&pe(l),f=l[0].pieces,p=[];for(let d=0;d<f.length;d+=1)p[d]=he(de(l,f,d));const b=d=>k(p[d],1,1,()=>{p[d]=null});return{c(){e=w("span"),s=A("Player "),o=A(t),n=I(),c&&c.c(),r=I(),a=w("div");for(let d=0;d<p.length;d+=1)p[d].c();this.h()},l(d){e=M(d,"SPAN",{});var u=E(e);s=N(u,"Player "),o=N(u,t),u.forEach(_),n=C(d),c&&c.l(d),r=C(d),a=M(d,"DIV",{class:!0});var h=E(a);for(let g=0;g<p.length;g+=1)p[g].l(h);h.forEach(_),this.h()},h(){W(a,"class","overlay svelte-rwgxl1")},m(d,u){S(d,e,u),v(e,s),v(e,o),S(d,n,u),c&&c.m(d,u),S(d,r,u),S(d,a,u);for(let h=0;h<p.length;h+=1)p[h].m(a,null);i=!0},p(d,[u]){if((!i||u&1)&&t!==(t=d[0].player+"")&&Z(o,t),d[1]?c&&(c.d(1),c=null):c?c.p(d,u):(c=pe(d),c.c(),c.m(r.parentNode,r)),u&7){f=d[0].pieces;let h;for(h=0;h<f.length;h+=1){const g=de(d,f,h);p[h]?(p[h].p(g,u),y(p[h],1)):(p[h]=he(g),p[h].c(),y(p[h],1),p[h].m(a,null))}for(x(),h=f.length;h<p.length;h+=1)b(h);ee()}},i(d){if(!i){for(let u=0;u<f.length;u+=1)y(p[u]);i=!0}},o(d){p=p.filter(Boolean);for(let u=0;u<p.length;u+=1)k(p[u]);i=!1},d(d){d&&_(e),d&&_(n),c&&c.d(d),d&&_(r),d&&_(a),Y(p,d)}}}function Te(l,e,s){let{hand:t}=e,{disabled:o}=e,{onSelectPiece:n}=e,{onSelectAuto:r}=e;const a=()=>r(t,"random"),i=()=>r(t,"win_or_random"),c=f=>n(t,f);return l.$$set=f=>{"hand"in f&&s(0,t=f.hand),"disabled"in f&&s(1,o=f.disabled),"onSelectPiece"in f&&s(2,n=f.onSelectPiece),"onSelectAuto"in f&&s(3,r=f.onSelectAuto)},[t,o,n,r,a,i,c]}class X extends J{constructor(e){super(),L(this,e,Te,Be,q,{hand:0,disabled:1,onSelectPiece:2,onSelectAuto:3})}}function _e(l){let e,s,t,o,n,r,a=l[0].state.player+"",i,c,f,p,b,d;return{c(){e=w("div"),s=w("span"),t=A("Game over!"),o=I(),n=w("span"),r=A("Winner: Player "),i=A(a),c=I(),f=w("button"),p=A("Play again")},l(u){e=M(u,"DIV",{});var h=E(e);s=M(h,"SPAN",{});var g=E(s);t=N(g,"Game over!"),g.forEach(_),o=C(h),n=M(h,"SPAN",{});var O=E(n);r=N(O,"Winner: Player "),i=N(O,a),O.forEach(_),c=C(h),f=M(h,"BUTTON",{});var m=E(f);p=N(m,"Play again"),m.forEach(_),h.forEach(_)},m(u,h){S(u,e,h),v(e,s),v(s,t),v(e,o),v(e,n),v(n,r),v(n,i),v(e,c),v(e,f),v(f,p),b||(d=j(f,"click",l[6]),b=!0)},p(u,h){h&1&&a!==(a=u[0].state.player+"")&&Z(i,a)},d(u){u&&_(e),b=!1,d()}}}function De(l){let e,s,t,o;return e=new X({props:{onSelectAuto:l[4],onSelectPiece:l[3],hand:l[0].player2,disabled:!1}}),t=new X({props:{onSelectAuto:l[4],onSelectPiece:l[3],hand:l[0].player1,disabled:!0}}),{c(){D(e.$$.fragment),s=I(),D(t.$$.fragment)},l(n){H(e.$$.fragment,n),s=C(n),H(t.$$.fragment,n)},m(n,r){G(e,n,r),S(n,s,r),G(t,n,r),o=!0},p(n,r){const a={};r&1&&(a.hand=n[0].player2),e.$set(a);const i={};r&1&&(i.hand=n[0].player1),t.$set(i)},i(n){o||(y(e.$$.fragment,n),y(t.$$.fragment,n),o=!0)},o(n){k(e.$$.fragment,n),k(t.$$.fragment,n),o=!1},d(n){V(e,n),n&&_(s),V(t,n)}}}function He(l){let e,s,t,o;return e=new X({props:{onSelectAuto:l[4],onSelectPiece:l[3],hand:l[0].player1,disabled:!1}}),t=new X({props:{onSelectAuto:l[4],onSelectPiece:l[3],hand:l[0].player2,disabled:!0}}),{c(){D(e.$$.fragment),s=I(),D(t.$$.fragment)},l(n){H(e.$$.fragment,n),s=C(n),H(t.$$.fragment,n)},m(n,r){G(e,n,r),S(n,s,r),G(t,n,r),o=!0},p(n,r){const a={};r&1&&(a.hand=n[0].player1),e.$set(a);const i={};r&1&&(i.hand=n[0].player2),t.$set(i)},i(n){o||(y(e.$$.fragment,n),y(t.$$.fragment,n),o=!0)},o(n){k(e.$$.fragment,n),k(t.$$.fragment,n),o=!1},d(n){V(e,n),n&&_(s),V(t,n)}}}function Ge(l){let e,s,t=l[1]?"Human player 2":"Computer player 2",o,n,r,a,i,c,f,p,b,d;r=new Ne({props:{onSelectCell:l[2],game:l[0]}});let u=l[0].state.action==="winner"&&_e(l);const h=[He,De],g=[];function O(m,P){return m[0].state.player===1?0:1}return c=O(l),f=g[c]=h[c](l),{c(){e=w("div"),s=w("button"),o=A(t),n=I(),D(r.$$.fragment),a=I(),u&&u.c(),i=I(),f.c(),this.h()},l(m){e=M(m,"DIV",{class:!0});var P=E(e);s=M(P,"BUTTON",{});var U=E(s);o=N(U,t),U.forEach(_),n=C(P),H(r.$$.fragment,P),a=C(P),u&&u.l(P),i=C(P),f.l(P),P.forEach(_),this.h()},h(){W(e,"class","d-flex justify-content-center")},m(m,P){S(m,e,P),v(e,s),v(s,o),v(e,n),G(r,e,null),v(e,a),u&&u.m(e,null),v(e,i),g[c].m(e,null),p=!0,b||(d=j(s,"click",l[5]),b=!0)},p(m,[P]){(!p||P&2)&&t!==(t=m[1]?"Human player 2":"Computer player 2")&&Z(o,t);const U={};P&1&&(U.game=m[0]),r.$set(U),m[0].state.action==="winner"?u?u.p(m,P):(u=_e(m),u.c(),u.m(e,i)):u&&(u.d(1),u=null);let te=c;c=O(m),c===te?g[c].p(m,P):(x(),k(g[te],1,1,()=>{g[te]=null}),ee(),f=g[c],f?f.p(m,P):(f=g[c]=h[c](m),f.c()),y(f,1),f.m(e,null))},i(m){p||(y(r.$$.fragment,m),y(f),p=!0)},o(m){k(r.$$.fragment,m),k(f),p=!1},d(m){m&&_(e),V(r),u&&u.d(),g[c].d(),b=!1,d()}}}function Ve(l,e,s){let t=se(),o=!1;const n=()=>{["winner","select2"].includes(t.state.action)||t.state.player!==t.player2.player||!o||oe(t,t.player2)};return[t,o,(p,b)=>{if(t.state.action==="select2"){Q(t,{x:p,y:b})===0&&n(),s(0,t);return}const d=t.state.player===1?t.player1:t.player2;K(t,d,{x:p,y:b}),s(0,t)},(p,b)=>{F(t,p,b),s(0,t)},(p,b)=>{b==="random"&&ge(t,p),b==="win_or_random"&&oe(t,p),n(),s(0,t)},()=>s(1,o=!o),()=>s(0,t=se())]}class Oe extends J{constructor(e){super(),L(this,e,Ve,Ge,q,{})}}function We(l){let e,s;return e=new Oe({}),{c(){D(e.$$.fragment)},l(t){H(e.$$.fragment,t)},m(t,o){G(e,t,o),s=!0},p:z,i(t){s||(y(e.$$.fragment,t),s=!0)},o(t){k(e.$$.fragment,t),s=!1},d(t){V(e,t)}}}class Re extends J{constructor(e){super(),L(this,e,null,We,q,{})}}export{Re as default};
