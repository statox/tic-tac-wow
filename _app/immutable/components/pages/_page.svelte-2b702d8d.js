import{S as j,i as J,s as L,k as $,l as E,m as M,h as _,n as W,I as w,b as S,J as R,B as q,K as Y,q as A,a as I,r as N,c as C,G as v,u as Z,L as ke,f as y,g as x,d as ee,t as k,e as le,w as D,x as H,y as G,z as V,M as Se}from"../../chunks/index-3160ce5b.js";const ne=l=>{const e=l===1?1:-1,s=[1,1,2,2,3,3].map(t=>({value:t*e,selected:!1}));return{player:l,pieces:s}},se=()=>{const l=[];for(let s=0;s<3;s++){l.push([]);for(let t=0;t<3;t++)l[l.length-1].push([])}return{state:{player:1,action:"select1"},grid:l,player1:ne(1),player2:ne(2)}},T=(l,e,s)=>{if(e<0||s<0||e>2||s>2)throw new Error(`Invalid coordinates ${e},${s}`);if(!l[s][e].length)return null;const t=l[s][e][l[s][e].length-1];return t.value>0?1:t.value<0?2:null},me=(l,e,s)=>{if(e<0||s<0||e>2||s>2)throw new Error(`Invalid coordinates ${e},${s}`);if(!l[s][e].length)return 0;const t=l[s][e][l[s][e].length-1];return Math.abs(t.value)},B=(l,e,s)=>{const t=T(l,e.x,e.y),r=T(l,s.x,s.y);return t!==null&&t===r},ve=l=>{const{grid:e}=l,s=new Set;for(let t=0;t<3;t++)if(B(e,{x:0,y:t},{x:1,y:t})&&B(e,{x:0,y:t},{x:2,y:t})){const r=T(e,0,t);s.add(r)}for(let t=0;t<3;t++)if(B(e,{x:t,y:0},{x:t,y:1})&&B(e,{x:t,y:0},{x:t,y:2})){const r=T(e,t,0);s.add(r)}if(B(e,{x:0,y:0},{x:1,y:1})&&B(e,{x:0,y:0},{x:2,y:2})){const t=T(e,0,0);s.add(t)}if(B(e,{x:0,y:2},{x:1,y:1})&&B(e,{x:0,y:2},{x:2,y:0})){const t=T(e,0,2);s.add(t)}if(s.delete(null),s.size===1){l.state.player=[...s.values()][0],l.state.action="winner";return}if(s.size===2){l.state.player=1,l.state.action="draw";return}},be=(l,e)=>{const s=[];for(let t=0;t<3;t++)for(let r=0;r<3;r++){const n=me(l.grid,r,t);(!n||n<Math.abs(e.value))&&s.push({x:r,y:t})}return s},we=(l,e)=>ye(l,e).reduce((r,n)=>{const o=z(l,n),a=be(l,o);return a.length&&r.set(n,a),r},new Map),ye=(l,e)=>{const s=e.pieces.map((t,r)=>({indexInHand:r,from:"hand"}));for(let t=0;t<3;t++)for(let r=0;r<3;r++)T(l.grid,r,t)===e.player&&s.push({from:"board",position:{x:r,y:t}});return s},z=(l,e)=>{if(e.from==="board"){const t=l.grid[e.position.y][e.position.x];return t[t.length-1]}return(l.state.player===1?l.player1:l.player2).pieces[e.indexInHand]},$e=l=>JSON.parse(JSON.stringify(l)),Ee=(l,e,s)=>{e&&console.log(e);for(const t of[l.player1,l.player2]){if(s){console.log(`P${t.player}:`,t.pieces.map(r=>`${r.value}-${r.selected}`),t.selectedPiece);continue}console.log(`P${t.player}:`,t.pieces.map(r=>r.value))}},F=(l,e,s)=>{if(l.state.player!==e.player||l.state.action!=="select1")return;if(e.pieces.findIndex(r=>r.value===s.value)===-1)throw new Error("Tried to select a piece which is not in hand");e.pieces.forEach(r=>r.selected=!1),s.selected=!0,e.selectedPiece={...s,from:"hand"},l.state.action="select2"},K=(l,e,s)=>{if(l.state.player!==e.player||l.state.action!=="select1")return;const{x:t,y:r}=s;if(t<0||r<0||t>2||r>2)throw new Error(`Invalid coordinates ${t},${r}`);l.grid[r][t].length!==0&&T(l.grid,t,r)===e.player&&(e.pieces.forEach(n=>n.selected=!1),l.grid[r][t][l.grid[r][t].length-1].selected=!0,e.selectedPiece={...l.grid[r][t][l.grid[r][t].length-1],from:"board",position:{x:t,y:r}},l.state.action="select2")},Q=(l,e)=>{var n;if(l.state.action!=="select2")return console.log("invalid state action"),-1;const s=l.state.player===1?l.player1:l.player2;if(!s.selectedPiece)return console.log("no selected piece"),-1;const{x:t,y:r}=e;if(me(l.grid,t,r)>=Math.abs(s.selectedPiece.value))return console.log("invalid board cell"),-1;if(l.grid[r][t].push({value:s.selectedPiece.value,selected:!1}),s.selectedPiece.from==="hand"){const o=s.pieces.findIndex(a=>a.selected);if(o===-1)throw Ee(l,"Invalid piece selection",!0),new Error("Tried to move piece not in hand");s.pieces.splice(o,1)}if(s.selectedPiece.from==="board")for(let o=0;o<3;o++)for(let a=0;a<3;a++)(n=l.grid[o][a][l.grid[o][a].length-1])!=null&&n.selected&&l.grid[o][a].pop();return s.selectedPiece=void 0,l.state.action="select1",l.state.player=l.state.player===1?2:1,ve(l),0},ge=(l,e)=>{const s=we(l,e);if(s.size===0)throw Error("No move possible");const t=Array.from(s.keys()),r=Math.floor(Math.random()*t.length),n=t[r],o=z(l,n),a=Math.floor(Math.random()*s.get(n).length),i=s.get(n)[a];n.from==="hand"?F(l,e,o):K(l,e,n.position),Q(l,i)},re=(l,e)=>{const s=ye(l,e);if(s.length===0)throw Error("No move possible");const t=s.sort(()=>Math.random()-.5);for(;t.length;){const r=t.pop();if(!r)continue;const n=z(l,r),a=[...be(l,n)].sort(()=>Math.random()-.5);for(;a.length;){const i=$e(l),c=i.state.player===1?i.player1:i.player2,f=z(i,r),p=a.pop();if(p&&(r.from==="hand"?F(i,c,f):K(i,c,r.position),Q(i,p),ve(i),i.state.action==="winner"&&i.state.player===e.player)){const b=z(l,r);r.from==="hand"?F(l,e,b):K(l,e,r.position),Q(l,p);return}}}ge(l,e)};function oe(l,e,s){const t=l.slice();return t[4]=e[s],t}function ae(l){let e,s=l[4].value+"",t,r;return{c(){e=$("div"),t=A(s),r=I(),this.h()},l(n){e=E(n,"DIV",{class:!0});var o=M(e);t=N(o,s),r=C(o),o.forEach(_),this.h()},h(){W(e,"class","piece svelte-1bwmfvs"),w(e,"player1",l[4].value>0),w(e,"player2",l[4].value<0),w(e,"small-circle",Math.abs(l[4].value)===1),w(e,"medium-circle",Math.abs(l[4].value)===2),w(e,"large-circle",Math.abs(l[4].value)===3)},m(n,o){S(n,e,o),v(e,t),v(e,r)},p(n,o){o&1&&s!==(s=n[4].value+"")&&Z(t,s),o&1&&w(e,"player1",n[4].value>0),o&1&&w(e,"player2",n[4].value<0),o&1&&w(e,"small-circle",Math.abs(n[4].value)===1),o&1&&w(e,"medium-circle",Math.abs(n[4].value)===2),o&1&&w(e,"large-circle",Math.abs(n[4].value)===3)},d(n){n&&_(e)}}}function Me(l){let e,s,t,r=[...l[0]].reverse(),n=[];for(let o=0;o<r.length;o+=1)n[o]=ae(oe(l,r,o));return{c(){e=$("button");for(let o=0;o<n.length;o+=1)n[o].c();this.h()},l(o){e=E(o,"BUTTON",{class:!0});var a=M(e);for(let i=0;i<n.length;i+=1)n[i].l(a);a.forEach(_),this.h()},h(){W(e,"class","cell svelte-1bwmfvs"),w(e,"selected",l[1]),w(e,"disabled",l[2])},m(o,a){S(o,e,a);for(let i=0;i<n.length;i+=1)n[i].m(e,null);s||(t=R(e,"click",l[3]),s=!0)},p(o,[a]){if(a&1){r=[...o[0]].reverse();let i;for(i=0;i<r.length;i+=1){const c=oe(o,r,i);n[i]?n[i].p(c,a):(n[i]=ae(c),n[i].c(),n[i].m(e,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=r.length}a&2&&w(e,"selected",o[1]),a&4&&w(e,"disabled",o[2])},i:q,o:q,d(o){o&&_(e),Y(n,o),s=!1,t()}}}function Ie(l,e,s){let{pieces:t}=e,{selected:r=!1}=e,{disabled:n}=e;function o(a){ke.call(this,l,a)}return l.$$set=a=>{"pieces"in a&&s(0,t=a.pieces),"selected"in a&&s(1,r=a.selected),"disabled"in a&&s(2,n=a.disabled)},[t,r,n,o]}class Pe extends j{constructor(e){super(),J(this,e,Ie,Me,L,{pieces:0,selected:1,disabled:2})}}function ie(l,e,s){const t=l.slice();return t[3]=e[s],t[5]=s,t}function ce(l,e,s){const t=l.slice();return t[6]=e[s],t[8]=s,t}function fe(l){var r;let e,s;function t(){return l[2](l[8],l[5])}return e=new Pe({props:{pieces:l[6],disabled:!1,selected:(r=l[6][l[6].length-1])==null?void 0:r.selected}}),e.$on("click",t),{c(){D(e.$$.fragment)},l(n){H(e.$$.fragment,n)},m(n,o){G(e,n,o),s=!0},p(n,o){var i;l=n;const a={};o&1&&(a.pieces=l[6]),o&1&&(a.selected=(i=l[6][l[6].length-1])==null?void 0:i.selected),e.$set(a)},i(n){s||(y(e.$$.fragment,n),s=!0)},o(n){k(e.$$.fragment,n),s=!1},d(n){V(e,n)}}}function ue(l){let e,s,t=l[3],r=[];for(let o=0;o<t.length;o+=1)r[o]=fe(ce(l,t,o));const n=o=>k(r[o],1,1,()=>{r[o]=null});return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=le()},l(o){for(let a=0;a<r.length;a+=1)r[a].l(o);e=le()},m(o,a){for(let i=0;i<r.length;i+=1)r[i].m(o,a);S(o,e,a),s=!0},p(o,a){if(a&3){t=o[3];let i;for(i=0;i<t.length;i+=1){const c=ce(o,t,i);r[i]?(r[i].p(c,a),y(r[i],1)):(r[i]=fe(c),r[i].c(),y(r[i],1),r[i].m(e.parentNode,e))}for(x(),i=t.length;i<r.length;i+=1)n(i);ee()}},i(o){if(!s){for(let a=0;a<t.length;a+=1)y(r[a]);s=!0}},o(o){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)k(r[a]);s=!1},d(o){Y(r,o),o&&_(e)}}}function Ce(l){let e,s,t,r=l[0].grid,n=[];for(let a=0;a<r.length;a+=1)n[a]=ue(ie(l,r,a));const o=a=>k(n[a],1,1,()=>{n[a]=null});return{c(){e=$("div"),s=$("div");for(let a=0;a<n.length;a+=1)n[a].c();this.h()},l(a){e=E(a,"DIV",{class:!0});var i=M(e);s=E(i,"DIV",{class:!0});var c=M(s);for(let f=0;f<n.length;f+=1)n[f].l(c);c.forEach(_),i.forEach(_),this.h()},h(){W(s,"class","overlay svelte-1n6jeyv"),W(e,"class","board svelte-1n6jeyv")},m(a,i){S(a,e,i),v(e,s);for(let c=0;c<n.length;c+=1)n[c].m(s,null);t=!0},p(a,[i]){if(i&3){r=a[0].grid;let c;for(c=0;c<r.length;c+=1){const f=ie(a,r,c);n[c]?(n[c].p(f,i),y(n[c],1)):(n[c]=ue(f),n[c].c(),y(n[c],1),n[c].m(s,null))}for(x(),c=r.length;c<n.length;c+=1)o(c);ee()}},i(a){if(!t){for(let i=0;i<r.length;i+=1)y(n[i]);t=!0}},o(a){n=n.filter(Boolean);for(let i=0;i<n.length;i+=1)k(n[i]);t=!1},d(a){a&&_(e),Y(n,a)}}}function Ae(l,e,s){let{game:t}=e,{onSelectCell:r}=e;const n=(o,a)=>r(o,a);return l.$$set=o=>{"game"in o&&s(0,t=o.game),"onSelectCell"in o&&s(1,r=o.onSelectCell)},[t,r,n]}class Ne extends j{constructor(e){super(),J(this,e,Ae,Ce,L,{game:0,onSelectCell:1})}}function de(l,e,s){const t=l.slice();return t[7]=e[s],t}function pe(l){let e,s,t,r,n,o,a;return{c(){e=$("button"),s=A("Random"),t=I(),r=$("button"),n=A("Win or random")},l(i){e=E(i,"BUTTON",{});var c=M(e);s=N(c,"Random"),c.forEach(_),t=C(i),r=E(i,"BUTTON",{});var f=M(r);n=N(f,"Win or random"),f.forEach(_)},m(i,c){S(i,e,c),v(e,s),S(i,t,c),S(i,r,c),v(r,n),o||(a=[R(e,"click",l[4]),R(r,"click",l[5])],o=!0)},p:q,d(i){i&&_(e),i&&_(t),i&&_(r),o=!1,Se(a)}}}function he(l){let e,s;function t(){return l[6](l[7])}return e=new Pe({props:{disabled:l[1],pieces:[l[7]],selected:l[7].selected}}),e.$on("click",t),{c(){D(e.$$.fragment)},l(r){H(e.$$.fragment,r)},m(r,n){G(e,r,n),s=!0},p(r,n){l=r;const o={};n&2&&(o.disabled=l[1]),n&1&&(o.pieces=[l[7]]),n&1&&(o.selected=l[7].selected),e.$set(o)},i(r){s||(y(e.$$.fragment,r),s=!0)},o(r){k(e.$$.fragment,r),s=!1},d(r){V(e,r)}}}function Be(l){let e,s,t=l[0].player+"",r,n,o,a,i,c=!l[1]&&pe(l),f=l[0].pieces,p=[];for(let d=0;d<f.length;d+=1)p[d]=he(de(l,f,d));const b=d=>k(p[d],1,1,()=>{p[d]=null});return{c(){e=$("span"),s=A("Player "),r=A(t),n=I(),c&&c.c(),o=I(),a=$("div");for(let d=0;d<p.length;d+=1)p[d].c();this.h()},l(d){e=E(d,"SPAN",{});var u=M(e);s=N(u,"Player "),r=N(u,t),u.forEach(_),n=C(d),c&&c.l(d),o=C(d),a=E(d,"DIV",{class:!0});var h=M(a);for(let g=0;g<p.length;g+=1)p[g].l(h);h.forEach(_),this.h()},h(){W(a,"class","overlay svelte-rwgxl1")},m(d,u){S(d,e,u),v(e,s),v(e,r),S(d,n,u),c&&c.m(d,u),S(d,o,u),S(d,a,u);for(let h=0;h<p.length;h+=1)p[h].m(a,null);i=!0},p(d,[u]){if((!i||u&1)&&t!==(t=d[0].player+"")&&Z(r,t),d[1]?c&&(c.d(1),c=null):c?c.p(d,u):(c=pe(d),c.c(),c.m(o.parentNode,o)),u&7){f=d[0].pieces;let h;for(h=0;h<f.length;h+=1){const g=de(d,f,h);p[h]?(p[h].p(g,u),y(p[h],1)):(p[h]=he(g),p[h].c(),y(p[h],1),p[h].m(a,null))}for(x(),h=f.length;h<p.length;h+=1)b(h);ee()}},i(d){if(!i){for(let u=0;u<f.length;u+=1)y(p[u]);i=!0}},o(d){p=p.filter(Boolean);for(let u=0;u<p.length;u+=1)k(p[u]);i=!1},d(d){d&&_(e),d&&_(n),c&&c.d(d),d&&_(o),d&&_(a),Y(p,d)}}}function Te(l,e,s){let{hand:t}=e,{disabled:r}=e,{onSelectPiece:n}=e,{onSelectAuto:o}=e;const a=()=>o(t,"random"),i=()=>o(t,"win_or_random"),c=f=>n(t,f);return l.$$set=f=>{"hand"in f&&s(0,t=f.hand),"disabled"in f&&s(1,r=f.disabled),"onSelectPiece"in f&&s(2,n=f.onSelectPiece),"onSelectAuto"in f&&s(3,o=f.onSelectAuto)},[t,r,n,o,a,i,c]}class X extends j{constructor(e){super(),J(this,e,Te,Be,L,{hand:0,disabled:1,onSelectPiece:2,onSelectAuto:3})}}function _e(l){let e,s,t,r,n,o,a=l[0].state.player+"",i,c,f,p,b,d;return{c(){e=$("div"),s=$("span"),t=A("Game over!"),r=I(),n=$("span"),o=A("Winner: Player "),i=A(a),c=I(),f=$("button"),p=A("Play again")},l(u){e=E(u,"DIV",{});var h=M(e);s=E(h,"SPAN",{});var g=M(s);t=N(g,"Game over!"),g.forEach(_),r=C(h),n=E(h,"SPAN",{});var O=M(n);o=N(O,"Winner: Player "),i=N(O,a),O.forEach(_),c=C(h),f=E(h,"BUTTON",{});var m=M(f);p=N(m,"Play again"),m.forEach(_),h.forEach(_)},m(u,h){S(u,e,h),v(e,s),v(s,t),v(e,r),v(e,n),v(n,o),v(n,i),v(e,c),v(e,f),v(f,p),b||(d=R(f,"click",l[6]),b=!0)},p(u,h){h&1&&a!==(a=u[0].state.player+"")&&Z(i,a)},d(u){u&&_(e),b=!1,d()}}}function De(l){let e,s,t,r;return e=new X({props:{onSelectAuto:l[4],onSelectPiece:l[3],hand:l[0].player2,disabled:!1}}),t=new X({props:{onSelectAuto:l[4],onSelectPiece:l[3],hand:l[0].player1,disabled:!0}}),{c(){D(e.$$.fragment),s=I(),D(t.$$.fragment)},l(n){H(e.$$.fragment,n),s=C(n),H(t.$$.fragment,n)},m(n,o){G(e,n,o),S(n,s,o),G(t,n,o),r=!0},p(n,o){const a={};o&1&&(a.hand=n[0].player2),e.$set(a);const i={};o&1&&(i.hand=n[0].player1),t.$set(i)},i(n){r||(y(e.$$.fragment,n),y(t.$$.fragment,n),r=!0)},o(n){k(e.$$.fragment,n),k(t.$$.fragment,n),r=!1},d(n){V(e,n),n&&_(s),V(t,n)}}}function He(l){let e,s,t,r;return e=new X({props:{onSelectAuto:l[4],onSelectPiece:l[3],hand:l[0].player1,disabled:!1}}),t=new X({props:{onSelectAuto:l[4],onSelectPiece:l[3],hand:l[0].player2,disabled:!0}}),{c(){D(e.$$.fragment),s=I(),D(t.$$.fragment)},l(n){H(e.$$.fragment,n),s=C(n),H(t.$$.fragment,n)},m(n,o){G(e,n,o),S(n,s,o),G(t,n,o),r=!0},p(n,o){const a={};o&1&&(a.hand=n[0].player1),e.$set(a);const i={};o&1&&(i.hand=n[0].player2),t.$set(i)},i(n){r||(y(e.$$.fragment,n),y(t.$$.fragment,n),r=!0)},o(n){k(e.$$.fragment,n),k(t.$$.fragment,n),r=!1},d(n){V(e,n),n&&_(s),V(t,n)}}}function Ge(l){let e,s,t=l[1]?"Human player 2":"Computer player 2",r,n,o,a,i,c,f,p,b,d;o=new Ne({props:{onSelectCell:l[2],game:l[0]}});let u=l[0].state.action==="winner"&&_e(l);const h=[He,De],g=[];function O(m,P){return m[0].state.player===1?0:1}return c=O(l),f=g[c]=h[c](l),{c(){e=$("div"),s=$("button"),r=A(t),n=I(),D(o.$$.fragment),a=I(),u&&u.c(),i=I(),f.c(),this.h()},l(m){e=E(m,"DIV",{class:!0});var P=M(e);s=E(P,"BUTTON",{});var U=M(s);r=N(U,t),U.forEach(_),n=C(P),H(o.$$.fragment,P),a=C(P),u&&u.l(P),i=C(P),f.l(P),P.forEach(_),this.h()},h(){W(e,"class","d-flex justify-content-center")},m(m,P){S(m,e,P),v(e,s),v(s,r),v(e,n),G(o,e,null),v(e,a),u&&u.m(e,null),v(e,i),g[c].m(e,null),p=!0,b||(d=R(s,"click",l[5]),b=!0)},p(m,[P]){(!p||P&2)&&t!==(t=m[1]?"Human player 2":"Computer player 2")&&Z(r,t);const U={};P&1&&(U.game=m[0]),o.$set(U),m[0].state.action==="winner"?u?u.p(m,P):(u=_e(m),u.c(),u.m(e,i)):u&&(u.d(1),u=null);let te=c;c=O(m),c===te?g[c].p(m,P):(x(),k(g[te],1,1,()=>{g[te]=null}),ee(),f=g[c],f?f.p(m,P):(f=g[c]=h[c](m),f.c()),y(f,1),f.m(e,null))},i(m){p||(y(o.$$.fragment,m),y(f),p=!0)},o(m){k(o.$$.fragment,m),k(f),p=!1},d(m){m&&_(e),V(o),u&&u.d(),g[c].d(),b=!1,d()}}}function Ve(l,e,s){let t=se(),r=!1;const n=()=>{["winner","select2"].includes(t.state.action)||t.state.player!==t.player2.player||!r||re(t,t.player2)};return[t,r,(p,b)=>{if(t.state.action==="select2"){Q(t,{x:p,y:b})===0&&n(),s(0,t);return}const d=t.state.player===1?t.player1:t.player2;K(t,d,{x:p,y:b}),s(0,t)},(p,b)=>{F(t,p,b),s(0,t)},(p,b)=>{b==="random"&&ge(t,p),b==="win_or_random"&&re(t,p),n(),s(0,t)},()=>s(1,r=!r),()=>s(0,t=se())]}class Oe extends j{constructor(e){super(),J(this,e,Ve,Ge,L,{})}}function We(l){let e,s;return e=new Oe({}),{c(){D(e.$$.fragment)},l(t){H(e.$$.fragment,t)},m(t,r){G(e,t,r),s=!0},p:q,i(t){s||(y(e.$$.fragment,t),s=!0)},o(t){k(e.$$.fragment,t),s=!1},d(t){V(e,t)}}}class ze extends j{constructor(e){super(),J(this,e,null,We,L,{})}}export{ze as default};
